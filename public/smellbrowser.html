<div>
    <div class="page-header">
        <h1>Smell Browser</h1>
    </div>
    <div class="well" ng-show="isAllowed.check(['Admin','Editor'])">
        <p>
            <button class="btn btn-primary btn-sm" ng-class="{ active:smellCtrl.formvisible}" ng-click="smellCtrl.showForm(!smellCtrl.formvisible)">Add Smell &raquo;</button>
        </p>
        <div ng-show="smellCtrl.formvisible">
            <form name="smellForm" ng-submit="smellForm.$valid && saveSmell()" novalidate>
                <div class="row">
                    <div class="col-md-7">
                        <fieldset class="form-group">
                            <label for="name">Name</label>
                            <input class="form-control" placeholder="Name of the Smell..." title="name" id="name" ng-model="smell.name" required></input>
                        </fieldset>
                        <fieldset class="form-group">
                            <label for="keywords">Keywords</label>
                            <input class="form-control" placeholder="Keywords to search for a Smell..." title="keywords" id="keywords" ng-model="smell.keywords" required></input>
                        </fieldset>
                        <fieldset class="form-group">
                            <label for="question">Questions</label>                    
                            <div class="input-group">
                                <input class="form-control" type="text" id="question" ng-model="questionToAdd" placeholder="Question..."></input>
                                <span class="input-group-btn">
                                    <a class="btn btn-primary" ng-click="questionToAdd !== '' && addQuestion()">
                                        <i class="glyphicon glyphicon-plus"></i>
                                    </a>
                                </span>
                            </div>
                            <div class="input-group" ng-repeat="question in smell.questions track by $index">
                                <input class="form-control" type="text" ng-model="question.question" readonly required></input>
                                <span class="input-group-btn">
                                    <a class="btn btn-warning" ng-click="removeQuestion($index)">
                                        <i class="glyphicon glyphicon-minus"></i>
                                    </a>
                                </span>
                            </div>
                        </fieldset>
                    </div>
            <div class="col-md-5">
                <fieldset class="form-group">
                    <label for="group">Group</label>
                    <ui-select ng-model="smell.group" theme="selectize" ng-disabled="disabled" required>
                        <ui-select-match placeholder="Select or search a group in the list...">{{$select.selected.name}}</ui-select-match>
                        <ui-select-choices repeat="group in groups | filter: $select.search">
                            <span ng-bind-html="group.name | highlight: $select.search"></span>
                        </ui-select-choices>
                    </ui-select>
                </fieldset>
                <fieldset class="form-group">
                    <label>Technical Debt Risk Index</label>
                    <table class="idxtable">
                        <tr>
                            <td id="problabel" class="problabel" rowspan="3">Probability</td>
                            <td>h&nbsp;</td>
                            <td ng-repeat="n in ['lh','mh','hh']">
                                <label class="btn btn-default dbt-idx-{{n}}">
                                    <input type="radio" name="tecdebtidx" ng-model="smell.tecdebtidx" ng-value="n" required/>
                                </label>
                            </td>
                        </tr>
                        <tr>
                            <td>m&nbsp;</td>
                            <td ng-repeat="n in ['lm','mm','hm']">
                                <label class="btn btn-default dbt-idx-{{n}}">
                                    <input type="radio" name="tecdebtidx" ng-model="smell.tecdebtidx" ng-value="n" required/>
                                </label>
                            </td>
                        </tr>
                        <tr>
                            <td>l&nbsp;</td>
                            <td ng-repeat="n in ['ll','ml','hl']">
                                <label class="btn btn-default dbt-idx-{{n}}">
                                    <input type="radio" name="tecdebtidx" ng-model="smell.tecdebtidx" ng-value="n" required/>
                                </label>
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td></td>
                            <td ng-repeat="n in ['l','m','h']">{{n}}</td>
                        </tr>
                        <tr>
                            <td></td>
                            <td></td>
                            <td class="implabel" colspan="3">Impact</td>
                        </tr>
                    </table>
                </fieldset>
            </div>
        </div>
        <fieldset class="form-group">
            <label for="description">Description</label>
            <text-angular name="smell-add-description" ng-model="smell.description" required></text-angular>
        </fieldset>
        <fieldset class="form-group">
            <div class="pull-right">
                <button type="submit" class="btn btn-primary" ng-disabled="smellForm.$invalid">Save Smell</button>&nbsp;
                <a class="btn btn-warning pull-right" ng-click="initSmell()">Cancel</a>
            </div>
        </fieldset>
        </form>
</div>
</div>
<div>
    <table id="searchObjResults" class="table table-striped table-hover non-select" popover-popup-delay="1000" popover="Double-Click rows to open Smell in detailed view" popover-trigger="mouseenter" popover-placement="right">
        <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Weight</th>
            <th>Group</th>
            <th>TecDebtIdx</th>
            <th></th>
        </tr>
        <tr>
            <td><input ng-model="search.name" placeholder="Enter search criteria" /></td>
            <td><input ng-model="search.description" placeholder="Enter search criteria" /></td>
            <td><input ng-model="search.weight" placeholder="Enter search criteria" /></td>
            <td><input ng-model="search.group.name" placeholder="Enter search criteria" /></td>
            <td><input ng-model="search.tecdebtidx" placeholder="Enter search criteria" /></td>
            <td><button type="button" class="btn btn-warning btn-sm" ng-click="search = []" popover="Clear filter fields" popover-trigger="mouseenter" popover-placement="right">clear</button></td>
        </tr>
        <tr>
            <th><a href ng-click="rname=!rname;order('name', rname)">Name <span ng-show="rname">&#x25B2;</span><span ng-show="!rname">&#x25BC;</span></a></th>
            <th><a href ng-click="rdesc=!rdesc;order('description', rdesc)">Description <span ng-show="rdesc">&#x25B2;</span><span ng-show="!rdesc">&#x25BC;</span></a></th>
            <th><a href ng-click="rweight=!rweight;order('weight', rweight)">Cloud Weight <span ng-show="rweight">&#x25B2;</span><span ng-show="!rweight">&#x25BC;</span></a></th>
            <th><a href ng-click="rgroup=!rgroup;order('group.name', rgroup)">Group <span ng-show="rgroup">&#x25B2;</span><span ng-show="!rgroup">&#x25BC;</span></a></th>
            <th><a href ng-click="rdebtidx=!rdebtidx;order('tecdebtidx', rdebtidx)">TecDebtIdx <span ng-show="rdebtidx">&#x25B2;</span><span ng-show="!rdebtidx">&#x25BC;</span></a></th>
            <th></th>
        </tr>
        <tr ng-show="smellCtrl.formvisible">
            <td>{{smell.name}}&nbsp;</td>
            <td>{{smell.description}}</td>
            <td>{{smell.weight}}</td>
            <td>{{smell.group.name}}</td>
            <td class="dbt-idx-{{smell.tecdebtidx}}">{{smell.tecdebtidx}}</td>
            <td></td>
        </tr>
        <tr ng-repeat="smellItem in smelllist | filter:search" ng-dblclick="$state.go('',{id: smellItem.id})">
            <td><a ui-sref="singlesmell({id: smellItem.id})">{{smellItem.name}}</a></td>
            <td ng-bind-html="smellItem.description | limitHtml: 30"></td>
            <td>{{smellItem.weight}}</td>
            <td>{{smellItem.group.name}}</td>
            <td class="dbt-idx-{{smellItem.tecdebtidx}}">{{smellItem.tecdebtidx}}</td>
            <td><a ui-sref="smellbrowser.edit({id: smellItem.id})" ng-show="isAllowed.check(['Admin','Editor'])"><span class="glyphicon glyphicon-pencil"></span></a>&nbsp;<a href ng-click="deleteSmell(smellItem.id)" ng-show="isAllowed.check(['Admin'])"><span class="glyphicon glyphicon-trash"></span></a></td>
        </tr>
    </table>
    <pagination total-items="bigTotalItems" ng-model="bigCurrentPage" max-size="maxSize" class="pagination-sm" boundary-links="true" rotate="false" num-pages="numPages"></pagination>
</div>
</div>