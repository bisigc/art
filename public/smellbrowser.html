<div>
    <div class="page-header">
        <h1>Smell Browser</h1>
    </div>
    <div class="well well-sm" ng-if="isAllowed.check(['Admin','Editor'])">
        <button class="btn btn-primary btn-sm" ng-class="{ active:formvisible}" ng-click="showForm(!formvisible)">Add Smell &raquo;</button>
        <div ng-if="formvisible">
            <div ui-view="addSmellView"></div>
        </div>
    </div>
    <div>
        <table id="searchObjResults" class="table table-striped table-hover non-select" uib-tooltip="Double-Click rows to open Smell in detailed view">
            <tr>
                <th>Name</th>
                <th>Description</th>
                <th>AR Appearances</th>
                <th>Group</th>
                <th>Tech Debt Index</th>
                <th></th>
            </tr>
            <tr>
                <td><input class="form-control" ng-model="search.name" placeholder="Filter..." /></td>
                <td><input class="form-control" ng-model="search.description" placeholder="Filter..." /></td>
                <td><input class="form-control" ng-model="search.weight" placeholder="Filter..." /></td>
                <td><input class="form-control" ng-model="search.group.name" placeholder="Filter..." /></td>
                <td><input class="form-control" ng-model="search.tecdebtidx" placeholder="Filter..." /></td>
                <td><button type="button" class="btn btn-warning btn-sm" ng-click="search = []" uib-tooltip="Clear filter fields">clear</button></td>
            </tr>
            <tr>
                <th><a ng-click="rname=!rname;order('name', rname)">Name <span ng-show="rname">&#x25B2;</span><span ng-show="!rname">&#x25BC;</span></a></th>
                <th><a ng-click="rdesc=!rdesc;order('description', rdesc)">Description <span ng-show="rdesc">&#x25B2;</span><span ng-show="!rdesc">&#x25BC;</span></a></th>
                <th><a ng-click="rweight=!rweight;order('weight', rweight)">AR Appearances <span ng-show="rweight">&#x25B2;</span><span ng-show="!rweight">&#x25BC;</span></a></th>
                <th><a ng-click="rgroup=!rgroup;order('group.name', rgroup)">Group <span ng-show="rgroup">&#x25B2;</span><span ng-show="!rgroup">&#x25BC;</span></a></th>
                <th><a ng-click="rdebtidx=!rdebtidx;order('tecdebtidx', rdebtidx)">Tech Debt Index <span ng-show="rdebtidx">&#x25B2;</span><span ng-show="!rdebtidx">&#x25BC;</span></a></th>
                <th></th>
            </tr>
            <tr ng-if="formvisible" class="bg-warning">
                <td>{{smell.name | limit: 30}}&nbsp;</td>
                <td>{{smell.description | limitHtml: 20}}</td>
                <td>{{smell.weight}}</td>
                <td>{{smell.group.name}}</td>
                <td class="dbt-idx-{{smell.tecdebtidx}}">{{smell.tecdebtidx}}</td>
                <td></td>
            </tr>
            <tr ng-repeat="smellItem in smelllist | filter:search" ng-dblclick="$state.go('root.singlesmell',{id: smellItem.id})">
                <td><a ui-sref="root.singlesmell({id: smellItem.id})" uib-tooltip="{{smellItem.name}}">{{smellItem.name | limit: 30}}</a></td>
                <td>
                    <script id="popoverdesc.html" type="text/ng-template">
                        <div ng-bind-html="smellItem.description | toSafeHtml"></div>
                    </script>
                    <span uib-popover-template="'popoverdesc.html'" popover-title="Full description" popover-trigger="mouseenter" popover-placement="right" popover-append-to-body>{{smellItem.description | limitHtml: 50 }}</span>
                </td>
                <td>{{smellItem.weight}}</td>
                <td>{{smellItem.group.name}}</td>
                <td class="dbt-idx-{{smellItem.tecdebtidx}}">{{smellItem.tecdebtidx}}</td>
                <td><a ui-sref="root.smellbrowser.edit({id: smellItem.id})" ng-if="isAllowed.check(['Admin','Editor'])" uib-tooltip="Edit Smell"><span class="glyphicon glyphicon-pencil"></span></a>&nbsp;<a href ng-click="deleteSmell(smellItem.id)" ng-if="isAllowed.check(['Admin'])" uib-tooltip="Delete Smell"><span class="glyphicon glyphicon-trash"></span></a></td>
            </tr>
        </table>
    </div>
</div>